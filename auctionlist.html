<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>H&H2015 - Yale School of Medicine</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/agency.css" rel="stylesheet">
    <link href="css/extra.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Cardo:400,400italic,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Arvo:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400italic,900,900italic" rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Load Parse framework -->
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    
    <!-- Connect to Parse -->
    <script type="text/javascript">
	  
	  $.holdReady(true);
	  
	  function formSubmit(itemID) {
	  	
		event.preventDefault();
		var userEmail = document.getElementById("email").value;
		var userBid = parseInt(document.getElementById("bid").value, 10);
	
		var ItemObj = Parse.Object.extend("Item");
		var itemQuery = new Parse.Query(ItemObj);
		itemQuery.get(itemID, {
			success: function(item) {
				
				if (!item)
				 return;
	
				var date = Date.now();
	
				// Make sure bidding on this item hasn't closed.
				if (date > item.get("closetime")) {
					alert("Bidding for this item has ended.");
					return;
				}
	
				// Make sure the bidder isn't already winning the item
				var allWinners = item.get("currentWinners");
				if (allWinners.indexOf(userEmail) > -1) {
					alert("You are already one of the winners for this item!");
					return;
				}
	
				// Make sure the bid increments current max bid by at least the minimum increment
				var allWinningBids = item.get("currentPrice");
	            		var minIncrement = item.get("priceIncrement");
	            		if (!minIncrement) {
	        			minIncrement = 1;
	            		}
				if (userBid < (allWinningBids[allWinningBids.length-1] + minIncrement) ) {
					alert("You need to raise the current price by at least $" + minIncrement);
					return;
				}
	
				// Sanity check. In-house testing revealed that people love bidding one trillion dollars.
				if (userBid > 99999) {
					alert("Remind me to apply for your job.");
					return;
				}
	
				// Add the new bid to the end of the currentPrice list
				allWinningBids.push(userBid);
				
				//And do the same for the currentWinners list
				var allWinners = item.get("currentWinners");
				allWinners.push(userEmail);
	   			    
				// Slice off either the top n bids (for an item where the highest n bids win)
				// or all of them if there are fewer than n bids.
				var removedWinner = "";
				if (allWinningBids.length > item.get("qty") ) {
					var currentWinningBids = allWinningBids.slice(1);
					var currentWinners = allWinners.slice(1); 
					var removedWinner = allWinners[0];
				}
				else {
					var currentWinningBids = allWinningBids;
					var currentWinners = allWinners; 
				}
	
				// Add this bidder to the list of all bidders...
				var allBidders = item.get("allBidders");
				allBidders.push(userEmail);
	
				// ...and remove them if they're already there.
				var uniqueArray = allBidders.filter(function(elem, pos) {
					return allBidders.indexOf(elem) == pos;
				});
				
				// If someone was pushed out of the winners list, add them to previousWinners
				var previousWinners = item.get("previousWinners");
				if ( !(removedWinner === "") ) {
					previousWinners.push(removedWinner);
				}
				// Then remove them if they're already there
				//var uniqueArray2 = previousWinners.filter(function(elem, pos) {
				//	previousWinners.indexOf(elem) == pos;
				//});
	
				item.set("allBidders", uniqueArray);
				item.set("currentPrice", currentWinningBids);
				item.set("currentWinners", currentWinners);
				item.set("previousWinners", previousWinners);
				item.set("numberOfBids", item.get("numberOfBids")+1);
	
				// Save all these updates back to the Item.
				item.save(null, {
					success: function(item) {
						alert("Bid placed!");
						response.success();
					},
					error: function(item, error) {
						console.error(error);
						response.error("Something went wrong - try again?");
					}
				});
	
				//Refresh the page so that new bid is registered
				location.reload(forceGet = true);
			},
			error: function(error) {
			    console.error("Error: " + error.code + " " + error.message);
			    response.error("Error: " + error.code + " " + error.message);
			}
		});
		  
		return false;
	}
	
	Parse.initialize("chABEeTQYArwMl0UQX1kC24rOzuYL30Ofxvx31Qr", "B6EAGCyj0t2clP0xFyID1pMnnM40RBgrpS4m4izV");
	
	var thisItemID = "4Von0Iso2g";
    	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
  				$("#item-img-1").attr( "src", item.get("imageurl") );
  			$("#item-name-1").html( item.get("name") );
  			$("#item-donor-1").html( item.get("donorname") );
  			$("#modal-link-1").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
  	
  	var thisItemID = "F6dwBizQbs";
  	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
  				$("#item-img-2").attr( "src", item.get("imageurl") );
  			$("#item-name-2").html( item.get("name") );
  			$("#item-donor-2").html( item.get("donorname") );
  			$("#modal-link-2").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
  	
  	var thisItemID = "8BXVWkeiF0";
  	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
	  			$("#item-img-3").attr( "src", item.get("imageurl") );
  			$("#item-name-3").html( item.get("name") );
  			$("#item-donor-3").html( item.get("donorname") );
  			$("#modal-link-3").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
  	
  	var thisItemID = "DTfrlv3wQU";
  	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
  				$("#item-img-4").attr( "src", item.get("imageurl") );
  			$("#item-name-4").html( item.get("name") );
  			$("#item-donor-4").html( item.get("donorname") );
  			$("#modal-link-4").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
  	
  	var thisItemID = "37NAUDjTzF";
  	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
  				$("#item-img-5").attr( "src", item.get("imageurl") );
  			$("#item-name-5").html( item.get("name") );
  			$("#item-donor-5").html( item.get("donorname") );
  			$("#modal-link-5").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
  	
  	var thisItemID = "jV6BlhQTbv";
  	var ItemObj = Parse.Object.extend("Item");
  	var itemQuery = new Parse.Query(ItemObj);
  	itemQuery.get(thisItemID, {
  		success: function(item) {
  			if (item.get("imageurl").length > 0)
  				$("#item-img-6").attr( "src", item.get("imageurl") );
  			$("#item-name-6").html( item.get("name") );
  			$("#item-donor-6").html( item.get("donorname") );
  			$("#modal-link-6").attr( "data-parseid", thisItemID );
  		},
  		error: function(item, error) {
	  		response.error("Error: " + error.code + " " + error.message);
		}
  	});
	
	$.holdReady(false);
	
	$(document).ready( function() {
		var afterHTML = "<div class='bid-email'><label for='email'>E-mail:</label><input type='text' id='email' name='user_email' /></div> <div class='bid-amt'><label for='bid'>Your bid:</label><input type='number' id='bid' name='user_bid' min=1 max=9999 /></div> <div class='bid-submit'><input type='submit' value='Place Bid!' /></div> </form>";
            	$('#portfolioModal').on('show.bs.modal', function (event) {
 			var button = $(event.relatedTarget); // Button that triggered the modal
  			var currID = button.data('parseid'); // Extract info from data-* attributes

  			// Update the modal's content.
  			var ItemObj = Parse.Object.extend("Item");
  			var itemQuery = new Parse.Query(ItemObj);
  			var modal = $(this);
  			itemQuery.get(currID, {
  				success: function(item) {
  					modal.find('.item-name').html( item.get("name") );
	  				modal.find('.donor').html( "Donated by " + item.get("donorname") );
	  				modal.find('.item-img').attr( "src", item.get("imageurl") );
	  				modal.find('.desc').html( item.get("description") );
	  				modal.find('.quant').html( "Number Available: " + item.get("qty") );
	  				modal.find('.price').html( "Current Price: $" + Math.max.apply(Math, item.get("currentPrice")) );
	  				modal.find('.currWin').html( "Current Winners: " + item.get("currentWinners") );
	  				modal.find('.bid-form').html( "<form method='post' onsubmit='formSubmit(&quot;" + currID + "&quot;);'>" + afterHTML );
		  		},
		  		error: function(item, error) {
			  		alert("Error: " + error.code + " " + error.message);
			  		response.error("Error: " + error.code + " " + error.message);
				}
		  	});
		});
	});
	
    </script>

</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">
                  <img src="http://tsathe.github.io/hh2015/img/logo.png">
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#event">Event</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#info">Info</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#donate">Donate</a>
                    </li>
                    <!-- <li>
                        <a class="page-scroll" href="#team">Team</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#contact">Contact</a>
                    </li>-->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <!-- Portfolio Grid Section -->
    <section id="portfolio" class="bg-light-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Auction List</h2>
                    <h3 class="section-subheading text-muted">Let the bidding begin!</h3>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-1" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-1" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-1">Espresso Brownies</h4>
                        <p id="item-donor-1" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-2" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-2" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-2">Espresso Brownies</h4>
                        <p id="item-donor-2" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-3" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-3" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-3">Espresso Brownies</h4>
                        <p id="item-donor-3" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-4" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-4" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-4">Espresso Brownies</h4>
                        <p id="item-donor-4" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-5" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-5" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-5">Espresso Brownies</h4>
                        <p id="item-donor-5" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
                <div class="col-md-4 col-sm-6 portfolio-item">
                    <a href="#portfolioModal" id="modal-link-6" class="portfolio-link" data-toggle="modal" data-parseid="">
                        <div class="portfolio-hover">
                            <div class="portfolio-hover-content">
                                <i class="fa fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <div class="height-wrap" style="max-height:241px;overflow:hidden">
                            <img id="item-img-6" src="img/portfolio/default-load.jpg" class="img-responsive" alt="">
                        </div>
                    </a>
                    <div class="portfolio-caption">
                        <h4 id="item-name-6">Espresso Brownies</h4>
                        <p id="item-donor-6" class="text-muted">Alison Bonds</p>
                    </div>
                </div>
                
            </div>
        </div>
    </section>

    
    <!-- Portfolio Modal Template -->
    <div class="portfolio-modal modal fade" id="portfolioModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-content">
            <div class="close-modal" data-dismiss="modal">
                <div class="lr">
                    <div class="rl">
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <div class="modal-body">
                            <h2 class="item-name">Project Heading</h2>
                            <p class="donor item-intro text-muted">Lorem ipsum dolor sit amet consectetur.</p>
                            <img class="item-img img-responsive img-centered" src="default.png" alt="">
                            <p class="desc"><a href="http://designmodo.com/startup/?u=787">Startup Framework</a> is a website builder for professionals. Startup Framework contains components and complex blocks (PSD+HTML Bootstrap themes and templates) which can easily be integrated into almost any design. All of these components are made in the same style, and can easily be integrated into projects, allowing you to create hundreds of solutions for your future projects.</p>
                            
                            <p class="quant"></p>
			    <p class="price"></p>
			    <p class="currWin"></p>
                            
                            <!-- Insert form here -->
			    <div class="bid-form">
	                    </div>
                            
                            <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-times"></i> Close Project</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <!-- <script src="js/contact_me.js"></script> -->

    <!-- Custom Theme JavaScript -->
    <script src="js/agency.js"></script>

  </body>

  </html>
